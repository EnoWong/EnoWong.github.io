/* === 功能补丁：零侵入，仅向全局注入 convertFiles() === */
(()=>{const API="https://api.convertx.tld/v1/convert",MAX=5,lang={zh:["准备中…","转换完成","转换失败","请选择文件"],en:["Preparing…","Conversion complete!","Conversion failed","Please select files"]};let l="zh";function t(e){return lang[l][e]}window.switchLang=e=>{l=e};async function o(e,n){if(!e.length){alert(t(3));return}const a=document.getElementById("convertDocument"),c=document.getElementById("documentProgress"),r=document.getElementById("documentError"),s=document.querySelector(".progress-fill"),d=document.getElementById("documentResult");a.disabled=!0,c.style.display="block",r.style.display="none",s.style.width=0;const p=new JSZip;let i=0;async function f(a){const c=new FormData;c.append("file",a),c.append("to",n);const r=await fetch(API,{method:"POST",body:c});if(!r.ok)throw new Error(await r.text());const s=await r.blob();p.file(a.name.replace(/\.\w+$/, "")+"."+n,s),i++,s.style.width=i/e.length*100+"%"}const m=[...e];try{const e=Array.from({length:Math.min(MAX,m.length)},async()=>{while(m.length)await f(m.shift())});await Promise.all(e);const n=await p.generateAsync({type:"blob"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download="converted.zip",o.click(),d.innerHTML=`<div class="success-header">${t(1)}</div>`}catch(e){r.textContent=t(2)+": "+e.message,r.style.display="block"}finally{c.style.display="none",a.disabled=!1}}window.convertFiles=o;const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js",document.head.appendChild(e)})();
